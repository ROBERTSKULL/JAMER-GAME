<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farol Musical</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0f1720;color:#e6eef6;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;}
  h1,h2{margin:10px 0;text-align:center;}
  button{padding:8px 12px;margin:4px;background:#06b6d4;color:#042027;border:none;border-radius:6px;cursor:pointer;font-weight:600;}
  button.secondary{background:#0b1220;border:1px solid #06b6d4;color:#06b6d4;}
  input[type=text]{padding:6px 8px;margin:4px;border-radius:6px;border:1px solid #06b6d4;background:#0b1220;color:#e6eef6;}
  .hidden{display:none;}
  .card{background:rgba(255,255,255,0.05);padding:20px;border-radius:12px;margin:12px;width:90%;max-width:500px;text-align:center;}
  ul{list-style:none;padding:0;}
  li{margin:6px 0;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;}
  iframe{border:none;border-radius:6px;margin:8px 0;}
  .vote-btn{margin:4px;}
  .status{margin:8px 0;font-weight:bold;}
</style>
</head>
<body>

<h1>üéµ Farol Musical</h1>

<!-- Pantalla: Jugadores -->
<div class="card" id="screen-players">
  <h2>1Ô∏è‚É£ A√±adir jugadores</h2>
  <input type="text" id="playerName" placeholder="Nombre del jugador">
  <button onclick="addPlayer()">A√±adir jugador</button>
  <ul id="playerList"></ul>
  <button onclick="goSongs()">Siguiente ‚Üí A√±adir canciones</button>
</div>

<!-- Pantalla: Canciones -->
<div class="card hidden" id="screen-songs">
  <h2>2Ô∏è‚É£ A√±adir canciones</h2>
  <div class="status" id="currentPlayer">Jugador actual:</div>
  <input type="text" id="songUrl" placeholder="URL de YouTube de la canci√≥n">
  <button onclick="addSong()">A√±adir canci√≥n</button>
  <div class="status" id="songCount">Canciones a√±adidas:</div>
</div>

<!-- Pantalla: Juego -->
<div class="card hidden" id="screen-game">
  <h2>3Ô∏è‚É£ Juego en marcha</h2>
  <div id="playerTurn" class="status"></div>
  <div id="playerPattern" class="status"></div>
  <div id="playerPoints" class="status"></div>
  <div id="playerVote" class="status"></div>
  <div id="playerSong">
    <div id="playerSongContainer"></div>
  </div>
  <div id="voteButtons"></div>
</div>

<!-- Pantalla: Resultados -->
<div class="card hidden" id="screen-results">
  <h2>üèÜ Resultados</h2>
  <ul id="resultsList"></ul>
  <button onclick="location.reload()">üîÑ Jugar de nuevo</button>
</div>

<script>
let players=[], songs=[], currentSongIndex=0;
let currentRound=0;
const patterns=["G√©nero","D√©cada","Artista","Nacionalidad"];
let currentPattern="";
let currentSongOwner=0;

// --- Jugadores ---
function addPlayer(){
  const name=document.getElementById('playerName').value.trim();
  if(!name) return;
  players.push({name, points:0});
  document.getElementById('playerName').value='';
  renderPlayers();
}
function renderPlayers(){
  const ul=document.getElementById('playerList');
  ul.innerHTML='';
  players.forEach(p=>{
    const li=document.createElement('li');
    li.textContent=p.name;
    ul.appendChild(li);
  });
}
function goSongs(){
  if(players.length<2){ alert('A√±ade al menos 2 jugadores'); return; }
  currentRound=0;
  newRound();
  show('screen-songs');
}

// --- Canciones ---
function newRound(){
  if(currentRound>=patterns.length){ startGame(); return; }
  currentPattern=patterns[currentRound];
  currentSongOwner=0;
  songs=[]; // Reinicia canciones
  updateSongUI();
}
function updateSongUI(){
  document.getElementById('currentPlayer').textContent = 
    `Ronda ${currentRound+1} (${currentPattern}) ‚Üí A√±adiendo canciones de: ${players[currentSongOwner].name}`;
  document.getElementById('songCount').textContent = `Canciones a√±adidas: ${songs.filter(s=>s.owner===currentSongOwner).length}`;
}
function addSong(){
  const url=document.getElementById('songUrl').value.trim();
  if(!url) return;
  songs.push({url, owner:currentSongOwner});
  document.getElementById('songUrl').value='';
  if(songs.filter(s=>s.owner===currentSongOwner).length >= players.length){
    currentSongOwner++;
    if(currentSongOwner>=players.length){
      currentRound++;
      newRound();
      return;
    }
  }
  updateSongUI();
}

// --- Juego ---
function startGame(){
  songs.sort(()=>Math.random()-0.5);
  currentSongIndex=0;
  show('screen-game');
  loadSong();
}
function loadSong(){
  const song=songs[currentSongIndex];
  const videoId=(song.url.includes('v='))? song.url.split('v=')[1].split('&')[0] : song.url;
  document.getElementById('playerSongContainer').innerHTML=`<iframe width="300" height="200" src="https://www.youtube.com/embed/${videoId}?autoplay=1" allow="autoplay"></iframe>`;
  renderVotes();
  document.getElementById('playerTurn').textContent=`Canci√≥n actual: ${currentSongIndex+1} / ${songs.length}`;
  document.getElementById('playerPattern').textContent=`Patr√≥n: ${currentPattern}`;
}
function renderVotes(){
  const div=document.getElementById('voteButtons');
  div.innerHTML='';
  players.forEach((p,i)=>{
    const btn=document.createElement('button');
    btn.textContent=p.name;
    btn.className='vote-btn';
    btn.onclick=()=>vote(i);
    div.appendChild(btn);
  });
}
function vote(playerIndex){
  const song=songs[currentSongIndex];
  if(playerIndex===song.owner){ players[playerIndex].points--; }
  else{ players[playerIndex].points++; }
  currentSongIndex++;
  if(currentSongIndex>=songs.length){ showResults(); }
  else{ loadSong(); }
}

// --- Resultados ---
function showResults(){
  show('screen-results');
  const ul=document.getElementById('resultsList');
  ul.innerHTML='';
  players.sort((a,b)=>b.points-a.points);
  players.forEach(p=>{
    const li=document.createElement('li');
    li.textContent=`${p.name}: ${p.points} puntos`;
    ul.appendChild(li);
  });
}

// --- Utilidades ---
function show(screen){
  ['screen-players','screen-songs','screen-game','screen-results'].forEach(id=>{
    document.getElementById(id).classList.add('hidden');
  });
  document.getElementById(screen).classList.remove('hidden');
}
</script>
</body>
</html>
